<?xml version="1.0" encoding="UTF-8"?>
<!--
 * Copyright (c) Open Source Strategies, Inc.
 *
 * Opentaps is free software: you can redistribute it and/or modify it
 * under the terms of the GNU Affero General Public License as published
 * by the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Opentaps is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Opentaps.  If not, see <http://www.gnu.org/licenses/>.
-->

<entitymodel xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/entitymodel.xsd">
    <!-- ========================================================= -->
    <!-- ======================== Defaults ======================= -->
    <!-- ========================================================= -->
    <title>Order Data Import Entities</title>
    <description>Defines intermediate entities for importing order data</description>
    <copyright>Copyright (c) Open Source Strategies, Inc.</copyright>
    <author>Chris Liberty (cliberty@opensourcestrategies.com)</author>
    <version>1.0</version>

    <!-- ================================= -->
    <!-- org.opentaps.dataimport.orders -->
    <!-- ================================= -->

    <!-- for precise definitions of the field types see the file framework/entity/fieldtype/fieldtypeXXX.xml for your database XXX -->

    <entity entity-name="DataImportOrderHeader"
            package-name="org.opentaps.dataimport.orders"
            title="Intermediate import entity for order header data.">
        <field name="batchId" type="id-ne"/>
        <field name="orderId" type="long-varchar"></field>
        <field name="orderTypeId" type="id"></field>
        <field name="customerPartyId" type="long-varchar"></field>
        <field name="supplierPartyId" type="id"></field>
        <field name="orderDate" type="date-time"></field>
        <field name="currencyUomId" type="id"></field>
        <field name="shippingTotal" type="currency-amount"></field>
        <field name="orderTax" type="currency-amount">
            <description>Whole order tax. The total order tax is the sum of this and the line item taxes.</description>
        </field>
        <field name="taxAuthPartyId" type="id">
            <description>The partyId of the tax authority in TaxAuthority. Recommended for invoicing and financials.
            </description>
        </field>
        <field name="adjustmentsTotal" type="currency-amount"></field>
        <field name="grandTotal" type="currency-amount"></field>
        <field name="comments" type="comment"></field>
        <field name="productStoreId" type="id"/>
        <field name="salesChannelEnumId" type="id">
            <description>The salesChannelEnumId maps to a specific the order type: store 1,pos, web etc</description>
        </field>
        <field name="productStoreShipMethId" type="id">
            <description>The ProductStoreShipmentMeth corresponding to the shipment method the customer selected.
            </description>
        </field>
        <field name="orderClosed" type="indicator">
            <description>If set to N or n, the order will be created in the Approved state.</description>
        </field>
        <field name="shippingFirstName" type="name"/>
        <field name="shippingLastName" type="name"/>
        <field name="shippingCompanyName" type="name"/>
        <field name="shippingStreet" type="long-varchar"/>
        <field name="shippingCity" type="name"/>
        <field name="shippingRegion" type="id"/>
        <field name="shippingPostcode" type="short-varchar"/>
        <field name="shippingCountry" type="id"/>
        <field name="shippingPhone" type="short-varchar"/>
        <field name="shippingFax" type="short-varchar"/>
        
        <field name="billingFirstName" type="name"/>
        <field name="billingLastName" type="name"/>
        <field name="billingCompanyName" type="name"/>
        <field name="billingStreet" type="long-varchar"/>
        <field name="billingCity" type="name"/>
        <field name="billingRegion" type="id"/>
        <field name="billingPostcode" type="short-varchar"/>
        <field name="billingCountry" type="id"/>
        <field name="billingPhone" type="short-varchar"/>
        <field name="billingFax" type="short-varchar"/>
                                       
        <field name="importStatusId" type="id-ne">
            <description>Status of record import. Null is the same as DATAIMP_NOT_PROC.</description>
        </field>
        <field name="importError" type="very-long">
            <description>Error report for failed imports.</description>
        </field>
        <field name="processedTimestamp" type="date-time">
            <description>Special field for system to record when entry was successfully imported.
                Do not use for any other purpose.
            </description>
        </field>
        <prim-key field="batchId"/>
        <prim-key field="orderId"/>
        <relation type="one-nofk" fk-name="IMPT_ORDERHDR_TYPE" rel-entity-name="OrderType">
            <key-map field-name="orderTypeId"/>
        </relation>
        <relation type="one-nofk" fk-name="IMPT_ORDERHDR_PTY" rel-entity-name="Party" title="Customer">
            <key-map field-name="customerPartyId" rel-field-name="partyId"/>
        </relation>
        <relation type="one-nofk" fk-name="IMPT_ORDERHDR_SUPL" rel-entity-name="Party" title="Supplier">
            <key-map field-name="supplierPartyId" rel-field-name="partyId"/>
        </relation>
        <relation type="one-nofk" fk-name="IMPT_ORDERHDR_CUOM" rel-entity-name="Uom">
            <key-map field-name="currencyUomId" rel-field-name="uomId"/>
        </relation>
        <relation type="one-nofk" fk-name="IMPT_ORDERHDR_PSSM" rel-entity-name="ProductStoreShipmentMeth">
            <key-map field-name="productStoreShipMethId"/>
        </relation>
    </entity>
    
    <entity entity-name="DataImportOrderItem"
            package-name="org.opentaps.dataimport.orders"
            title="Intermediate import entity for order item data.">
        <field name="batchId" type="id-ne"/>
        <field name="orderId"               type="long-varchar" />
        <field name="orderItemId"               type="long-varchar" />        
        
        <field name="productId"             type="id" />
        <field name="goodIdentificationTypeId"  type="id" />
        <field name="productName"           type="description" />
        <field name="productSku"            type="id-long"/>
        <field name="quantity"              type="fixed-point" />
        <field name="quantityShipped"       type="fixed-point">
            <description>Quantity of this order item already shipped, meaningful only for not closed orders.
            </description>
        </field>
        <field name="price"                 type="currency-amount" />
        <field name="itemTax"               type="currency-amount">
            <description>Line item tax. Recommended for invoicing and financials.</description>
        </field>
        <field name="taxAuthPartyId"        type="id">
            <description>The partyId of the tax authority in TaxAuthority. Recommended for invoicing and financials.
            </description>
        </field>
        <field name="itemAdjustmentsTotal"  type="currency-amount" />
        <field name="customerPo"            type="id" />
        <field name="comments"              type="comment" />
        <field name="importStatusId"        type="id-ne">
            <description>Status of record import. Null is the same as DATAIMP_NOT_PROC.</description>
        </field>
        <field name="importError"           type="very-long">
            <description>Error report for failed imports.</description>
        </field>
        <field name="processedTimestamp"    type="date-time">
            <description>Special field for system to record when entry was successfully imported.
                Do not use for any other purpose.
            </description>
        </field>
        <field name="orderItemSeqId"        type="id">
            <description>Special field for system to record the primary orderItemSeqId created against this order item
                record.
                Do not use for any other purpose.
            </description>
        </field>
        <prim-key field="batchId"/>
        <prim-key field="orderId"/>
        <prim-key field="orderItemId"/>
        
        <!-- 
        <prim-key field="orderId"/>
        <prim-key field="productId"/>
        <prim-key field="quantity"/>
        <prim-key field="price"/> -->
        
        <!--<prim-key field="itemAdjustmentsTotal"/>  This field is not on the service. what does it do ?-->
        <relation type="one-nofk" fk-name="IMPT_ORDERITEM_HDR" rel-entity-name="DataImportOrderHeader">
            <key-map field-name="orderId"/>
        </relation>
        <!--removing this as we may import a product in the same batch-->
        <!--<relation type="one-nofk" fk-name="IMPT_ORDERITEM_PRD" rel-entity-name="Product">-->
        <!--<key-map field-name="productId"/>-->
        <!--</relation>-->
    </entity>
	
    <entity entity-name="DataImportOrderPayment"
            package-name="org.opentaps.dataimport.orders"
            title="Intermediate import entity for order payment data.">
       <field name="batchId" type="id-ne"></field>
        <field name="orderPaymentPreferenceId" type="id-ne"></field>
        <field name="orderId" type="long-varchar"></field>
        <field name="paymentMethodTypeId" type="id"></field>
        <field name="maxAmount" type="currency-amount"></field>
        <field name="statusId" type="id"></field>

        <field name="paymentTypeId" type="id-ne"></field>
        <field name="effectiveDate" type="date-time"></field>
        <field name="paymentRefNum" type="short-varchar"></field>
        <field name="amount" type="currency-amount"></field>
        <field name="currencyUomId" type="id"></field>
        <field name="comments" type="comment"></field>

        <field name="importStatusId" type="id-ne">
            <description>Status of record import. Null is the same as DATAIMP_NOT_PROC.</description>
        </field>
        <field name="importError" type="very-long">
            <description>Error report for failed imports.</description>
        </field>
        <field name="processedTimestamp" type="date-time">
            <description>Special field for system to record when entry was successfully imported.
                Do not use for any other purpose.
            </description>
        </field>
		<prim-key field="batchId"/>
        <prim-key field="orderId"/>
        <prim-key field="orderPaymentPreferenceId"/>

        <relation type="one-nofk" fk-name="DIOP_PMETH_TP" rel-entity-name="PaymentMethodType">
            <key-map field-name="paymentMethodTypeId"/>
        </relation>
    </entity>
    
    <entity entity-name="DataImportOrderAdjustment" package-name="org.groupfio.common.portal" title="DataImportOrderAdjustment">
		<field name="batchId" type="id-ne"/>
		<field name="orderId" type="id" />
		<field name="orderItemId" type="id" />
		<field name="adjustmentSeqId" type="id" />
		<field name="adjustmentLevel" type="id" />
		<field name="adjustmentType" type="id" />
		
		<field name="adjustmentPercent" type="currency-amount" />
		<field name="adjustmentAmount" type="currency-amount" />
		<field name="adjustmentDescription" type="description" />
		<field name="adjustmentMethod" type="id" />
		<field name="adjustmentRate" type="currency-amount" />
		<field name="printLine" type="id" />
		<field name="adjustmentReasonCode" type="id" />
		<field name="adjustmentReasonCodeType" type="id" />
		<field name="amountAdjustable" type="id" />
		<field name="promotionName" type="id-vlong" />
		<field name="couponCode" type="id" />
		<field name="marketingCampaignId" type="id" />
		<field name="marketingCampaignName" type="id-vlong" />
		<field name="adjustmentVoided" type="id" />
		<field name="adjustmentVoidedLine" type="id" />
		
		<field name="importStatusId" type="id-ne"><description>Status of record import.  Null is the same as DATAIMP_NOT_PROC.</description></field>
        <field name="importError" type="very-long"><description>Error report for failed imports.</description></field>
        <field name="processedTimestamp" type="date-time">
            <description>Special field for system to record when entry was successfully imported.  
                Do not use for any other purpose.</description>
        </field>
        <field name="errorCodes" type="very-long"/>
        <field name="approvedByUserLoginId" type="id-vlong"></field>
        <field name="rejectedByUserLoginId" type="id-vlong"></field>
        <field name="uploadedByUserLoginId" type="id-vlong"></field>
        <field name="importedFrom" type="id"></field>
        
        <field name="stepExecutionId" type="numeric"></field>
        <field name="jobExecutionId" type="numeric"></field>
        <field name="logId" type="id"></field>
		
		<prim-key field="batchId"/>
		<prim-key field="orderId"/>
		<prim-key field="adjustmentSeqId"/>
		<prim-key field="adjustmentLevel"/>
		<prim-key field="adjustmentType"/>
		<index name="dioa_index_01">
           <index-field name="orderId"/>
           <index-field name="adjustmentTypeId"/>
        </index>
        <index name="dioa_index_02">
           <index-field name="orderId"/>
           <index-field name="importStatusId"/>
        </index>
	</entity>
	
	<entity entity-name="DataImportOrderTaxAdjustment" package-name="org.groupfio.common.portal" title="DataImportOrderTaxAdjustment">
		<field name="batchId" type="id-ne"/>
		<field name="orderId" type="id" />
		<field name="orderItemId" type="id" />
		<field name="taxSeqId" type="id" />
		<field name="taxType" type="id" />
		
		<field name="taxAmount" type="currency-amount" />
		<field name="taxFlag" type="id" />
		<field name="taxPercentage" type="currency-amount" />
		<field name="taxDescription" type="description" />
		<field name="taxAmountExempt" type="id" />
		<field name="taxDetailNumber" type="id" />
		<field name="taxDetailNumberVoided" type="id" />
		<field name="taxNumber" type="id" />
		<field name="taxRuleCode" type="id" />
		<field name="taxValueExempt" type="id" />
		<field name="taxAmountTaxable" type="id" />
		<field name="taxLineVoided" type="id" />
		<field name="taxLineVoidingLine" type="id" />
		<field name="taxAuthority" type="id" />
		<field name="taxableAmount" type="id" />
		<field name="taxVoided" type="id" />
		<field name="taxVoidedLine" type="id" />
		<field name="taxIncluded" type="indicator" />
		
		<field name="importStatusId" type="id-ne"><description>Status of record import.  Null is the same as DATAIMP_NOT_PROC.</description></field>
        <field name="importError" type="very-long"><description>Error report for failed imports.</description></field>
        <field name="processedTimestamp" type="date-time">
            <description>Special field for system to record when entry was successfully imported.  
                Do not use for any other purpose.</description>
        </field>
        <field name="errorCodes" type="very-long"/>
        <field name="approvedByUserLoginId" type="id-vlong"></field>
        <field name="rejectedByUserLoginId" type="id-vlong"></field>
        <field name="uploadedByUserLoginId" type="id-vlong"></field>
        <field name="importedFrom" type="id"></field>
        
        <field name="stepExecutionId" type="numeric"></field>
        <field name="jobExecutionId" type="numeric"></field>
        <field name="logId" type="id"></field>
		
		<prim-key field="batchId"/>
		<prim-key field="orderId"/>
		<prim-key field="taxSeqId"/>
		<prim-key field="taxType"/>
		 <index name="diota_index_01">
           <index-field name="orderId"/>
           <index-field name="importStatusId"/>
        </index>
	</entity>
    
	<extend-entity entity-name="DataImportOrderHeader">
		<field name="firstName" type="name"/>
		<field name="lastName" type="name"/>
	</extend-entity>
	
	<extend-entity entity-name="DataImportOrderItem">
        <field name="codFee" type="currency-amount" />
        <field name="codFeeDiscount" type="currency-amount" />
		<field name="giftWrapFee" type="currency-amount" />
        <field name="amazonmerchantsku" type="id-vlong"/>
        <field name="requestId" type="very-long"/>
        <field name="giftMessageText" type="very-long" />
        <field name="giftWrapLevel" type="description" />
		<field name="dropShipFee" type="currency-precise"></field>		
		
		<field name="importedFrom" type="short-varchar"></field>
		<field name="prodCatalogId" type="id"></field>
		<field name="accessType" type="short-varchar"></field>
		<field name="acctgTagEnumId1" type="id-ne"/>
		<field name="itemPromotionDiscount" type="currency-amount" />
        <field name="shippingPromotionDiscount" type="currency-amount" />
		<field name="dropShipSupplierId" type="id-ne"></field>
		<field name="shopifyProductId" type="id-vlong"/>
        <field name="giftCard" type="indicator"/>
	</extend-entity>
	
</entitymodel>
